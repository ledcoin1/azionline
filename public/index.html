<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Game Lobby</title>
<style>
body{font-family:Arial,sans-serif;background:#1e1e1e;color:#fff;margin:0;padding:20px}
h1{margin-bottom:10px}
#balance{font-weight:bold}
#lobby{margin-top:20px}
ul{list-style:none;padding:0}
li{padding:4px 0;border-bottom:1px solid #333}
</style>
</head>
<body>

<h1>üïπ Mini Game Lobby</h1>
<p>–°—ñ–∑ –∫—ñ—Ä–¥—ñ“£—ñ–∑: <span id="userId">---</span></p>
<p>–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span></p>

<div id="lobby">
<h2>–õ–æ–±–±–∏–¥–∞“ì—ã –æ–π—ã–Ω—à—ã–ª–∞—Ä:</h2>
<ul id="players"></ul>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const API = "/"; // —Å–æ–ª —Å–µ—Ä–≤–µ—Ä–≥–µ —Å“±—Ä–∞—É –∂–∞—Å–∞–π–º—ã–∑
const socket = io(API);

async function init() {
  const tg = window.Telegram.WebApp;
  tg.ready();

  // Telegram ID –∞–ª—É
  const telegramId = tg.initDataUnsafe?.user?.id;
  if(!telegramId){
    alert("Telegram —ñ—à—ñ–Ω–µ–Ω –∞—à—ã“£—ã–∑!");
    return;
  }

  document.getElementById("userId").textContent = telegramId;

  // –°–µ—Ä–≤–µ—Ä–≥–µ login —Å“±—Ä–∞—É—ã
  const res = await fetch(API + "api/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ telegramId })
  });

  const user = await res.json();
  document.getElementById("balance").textContent = user.balance;

  // Socket.IO: –ª–æ–±–±–∏–≥–µ “õ–æ—Å—É
  socket.emit("joinLobby", telegramId);
}

// –õ–æ–±–±–∏ –∂–∞“£–∞—Ä—Ç—ã–ª“ì–∞–Ω–¥–∞
socket.on("lobbyUpdate", (players) => {
  const ul = document.getElementById("players");
  ul.innerHTML = "";
  players.forEach(id => {
    const li = document.createElement("li");
    li.textContent = id;
    ul.appendChild(li);
  });
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
init();
</script>

</body>
</html>
