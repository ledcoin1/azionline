<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8">
<title>Telegram MiniApp Game</title>
<style>
  body { font-family: Arial; background: #111; color: #fff; padding: 20px; }
  #info { margin-top: 20px; }
  #balance { font-weight: bold; }
  #error { color: red; margin-top: 20px; }
</style>
</head>
<body>

<h2>Ойынға қош келдіңіз!</h2>

<div id="info">
  Telegram ID: <span id="telegramId">...</span><br>
  Баланс: <span id="balance">0</span>
</div>

<div id="error"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const tg = window.Telegram?.WebApp;

  if (!tg) {
    document.getElementById("error").innerText = "❌ Telegram MiniApp емес немесе API табылмады";
    return;
  }

  tg.ready();

  const telegramId = tg.initDataUnsafe.user.id; // Telegram-ның жеке ID
  document.getElementById("telegramId").innerText = telegramId;

  // Серверге login сұрауы
  fetch("/api/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ telegramId })
  })
  .then(r => r.json())
  .then(data => {
    if(data.error){
      document.getElementById("error").innerText = "Login қатесі: " + data.error;
      return;
    }

    document.getElementById("balance").innerText = data.balance;
    console.log("Login сәтті:", data);
  })
  .catch(err => {
    console.error(err);
    document.getElementById("error").innerText = "Серверге қосылу қатесі";
  });
});
</script>

</body>
</html>
