<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>üÉè –û–Ω–ª–∞–π–Ω –ê–ó–ò</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body { font-family: Arial; text-align:center; background:#2e7d32; color:white; }
#lobby, #game { margin-top:50px; }
#table { width: 500px; height: 300px; background:#388e3c; margin:20px auto; border-radius:15px; position:relative; }
.card { width:60px; height:90px; background:white; color:black; border-radius:8px; line-height:90px; text-align:center; font-weight:bold; position:absolute; }
#myCards { margin-top:20px; }
button { padding:10px 15px; margin:3px; }
</style>
</head>
<body>

<h1>üÉè –û–Ω–ª–∞–π–Ω –ê–ó–ò (3 –∫–∞—Ä—Ç–∞)</h1>

<div id="lobby">
  <div id="info">–û–π—ã–Ω“ì–∞ “õ–æ—Å—ã–ª—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑</div>
  <button id="joinBtn">–û–π—ã–Ω“ì–∞ “õ–æ—Å—ã–ª—É</button>
</div>

<div id="game" style="display:none;">
  <div id="infoGame"></div>
  <div id="table"></div>
  <div id="myCards"></div>
</div>

<script>
const socket = io();
const info = document.getElementById("info");
const joinBtn = document.getElementById("joinBtn");
const lobby = document.getElementById("lobby");
const gameDiv = document.getElementById("game");
const tableDiv = document.getElementById("table");
const myCardsDiv = document.getElementById("myCards");
const infoGame = document.getElementById("infoGame");

const userId = Math.floor(Math.random()*1000);
let roomId = null;

joinBtn.onclick = ()=>{
  socket.emit("joinGame",{userId});
  joinBtn.disabled = true;
  info.innerText = "‚è≥ “ö–∞—Ä—Å—ã–ª–∞—Å –∫“Ø—Ç—ñ–ª—É–¥–µ...";
};

socket.on("message", msg => info.innerText = msg);

socket.on("startGame", ({opponentId, roomId: rId, trump})=>{
  lobby.style.display="none";
  gameDiv.style.display="block";
  roomId = rId;
  infoGame.innerText=`“ö–∞—Ä—Å—ã–ª–∞—Å: ${opponentId} | –ö”©–∑—ñ—Ä: ${trump}`;
});

socket.on("update", data=>{
  tableDiv.innerHTML="";
  data.table.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="card";
    div.style.left = `${100 + i*70}px`;
    div.style.bottom = i===0?"10px":"120px";
    div.innerText = c.card.suit+c.card.value;
    tableDiv.appendChild(div);
  });

  myCardsDiv.innerHTML="";
  data.hand.forEach((c,i)=>{
    const btn=document.createElement("button");
    btn.innerText=c.suit+c.value;
    btn.disabled = data.turn!==userId;
    btn.onclick = ()=>socket.emit("playCard",{roomId,userId,cardIndex:i});
    myCardsDiv.appendChild(btn);
  });

  infoGame.innerText=`–ö”©–∑—ñ—Ä: ${data.trump} | –ö–µ–∑–µ–∫: ${data.turn===userId?"–°–µ–Ω—ñ“£ –∫–µ–∑–µ–≥—ñ“£":"“ö–∞—Ä—Å—ã–ª–∞—Å –∫–µ–∑–µ–∫"}`;
});

socket.on("gameEnd", tricks=>{
  let opponent = Object.keys(tricks).find(x=>x!=userId);
  let result = tricks[userId]>tricks[opponent]?"üèÜ –ñ–ï“¢–î–Ü“¢":
               tricks[userId]<tricks[opponent]?"‚ùå “∞–¢–´–õ–î–´“¢":"ü§ù –¢–ï“¢";
  infoGame.innerHTML=`–û–π—ã–Ω –∞—è“õ—Ç–∞–ª–¥—ã!<br>–°–µ–Ω: ${tricks[userId]}, “ö–∞—Ä—Å—ã–ª–∞—Å: ${tricks[opponent]}<br><h2>${result}</h2>`;
  myCardsDiv.innerHTML="";
  tableDiv.innerHTML="";
});
</script>

</body>
</html>
