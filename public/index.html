<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Дурак Мини Апп</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
  #log { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; background: #fff; }
  .player-info { margin-bottom: 10px; }
  button { margin-right: 10px; }
  #hand { margin-top: 10px; }
  .card { display: inline-block; padding: 5px 10px; margin: 2px; border: 1px solid #333; border-radius: 4px; background: #fff; }
</style>
</head>
<body>

<h1>Дурак Мини Апп</h1>

<div id="info">
  <p>Баланс: <span id="balance">2000</span></p>
  <p>Комта банкі: <span id="bank">0</span></p>
  <p>Комта ID: <span id="roomId">---</span></p>
  <p>Раундқа қатысатындар: <span id="players">---</span></p>
  <p>Козырь: <span id="kozir">---</span></p>
</div>

<div id="actions">
  <button id="readyBtn">Готов</button>
  <button id="foldBtn">Отбой</button>
</div>

<div id="hand">
  <strong>Қолыңыздағы карталар:</strong>
  <div id="cards"></div>
</div>

<h3>Жүйе логы:</h3>
<div id="log"></div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io();

// HTML элементтер
const logEl = document.getElementById('log');
const balanceEl = document.getElementById('balance');
const bankEl = document.getElementById('bank');
const roomIdEl = document.getElementById('roomId');
const playersEl = document.getElementById('players');
const kozEl = document.getElementById('kozir');
const cardsEl = document.getElementById('cards');
const readyBtn = document.getElementById('readyBtn');
const foldBtn = document.getElementById('foldBtn');

let mySocketId = null;
let myBalance = 2000;

// Логқа жазу функциясы
function log(msg) {
  const p = document.createElement('p');
  p.textContent = msg;
  logEl.appendChild(p);
  logEl.scrollTop = logEl.scrollHeight;
}

// Өз socketId-імізді алу
socket.on('connect', () => {
  mySocketId = socket.id;
  log(`Серверге қосылды: ${mySocketId}`);
});

// Комтаға қосылғанда
socket.on('joinedRoom', (data) => {
  roomIdEl.textContent = data.roomId;
  playersEl.textContent = data.players.join(', ');
  bankEl.textContent = data.totalPot;
  log(`Комтаға қосылдың: ${data.roomId}`);
});

// Сервер 500 ставка сұрағанда
socket.on('askBet', (data) => {
  log(`Сервер сұрайды: ставка ${data.betAmount}`);
});

// Баланс жеткіліксіз болса
socket.on('notEnoughBalance', (data) => {
  alert(`Баланс жетпейді! Қажетті: ${data.required}, Қолыңызда: ${data.balance}`);
});

// Раунд басталғанда
socket.on('roundStart', (data) => {
  log(`Раунд басталды! Козырь: ${data.kozir}`);
  kozEl.textContent = data.kozir.suit + data.kozir.rank;
  bankEl.textContent = data.bank;
  cardsEl.innerHTML = '';
  data.players.forEach(p => {
    if (p.id === mySocketId) {
      p.hand.forEach(card => {
        const div = document.createElement('div');
        div.className = 'card';
        div.textContent = card.suit + card.rank;
        cardsEl.appendChild(div);
      });
    }
  });
});

// Батырмаларға жауап беру
readyBtn.addEventListener('click', () => {
  socket.emit('betResponse', { socketId: mySocketId, response: 'готов' });
  log('Ставка: готов басылды');
});

foldBtn.addEventListener('click', () => {
  socket.emit('betResponse', { socketId: mySocketId, response: 'отбой' });
  log('Ставка: отбой басылды');
});
</script>
</body>
</html>
