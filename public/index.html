<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Telegram Card Game</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #1e5631; /* –∂–∞—Å—ã–ª —Ñ–æ–Ω */
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      margin-top: 20px;
    }

    #lobby {
      margin: 20px;
    }

    #game {
      display: none;
      width: 100%;
      max-width: 800px;
      text-align: center;
    }

    #players {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }

    .player {
      border: 2px solid #fff;
      padding: 10px;
      border-radius: 10px;
      width: 120px;
    }

    #table {
      min-height: 150px;
      border: 2px dashed #fff;
      border-radius: 10px;
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px;
    }

    .card {
      background: #fff;
      color: #000;
      font-weight: bold;
      font-size: 20px;
      width: 50px;
      height: 70px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: scale(1.1);
    }

    #hand {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background-color: #ffcc00;
      color: #000;
      font-weight: bold;
    }

    #status {
      margin-bottom: 10px;
      min-height: 20px;
    }
  </style>
</head>
<body>
  <h1>üÉè Telegram Card Game</h1>

  <div id="lobby">
    <button id="playBtn">–ò–≥—Ä–∞—Ç—å</button>
    <p id="lobbyStatus">–û–∂–∏–¥–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤...</p>
  </div>

  <div id="game">
    <div id="status"></div>
    <div id="players"></div>
    <div id="table"></div>
    <div id="hand"></div>
  </div>

  <script>
    const socket = io();

    const playBtn = document.getElementById("playBtn");
    const lobbyStatus = document.getElementById("lobbyStatus");
    const gameDiv = document.getElementById("game");
    const playersDiv = document.getElementById("players");
    const tableDiv = document.getElementById("table");
    const handDiv = document.getElementById("hand");
    const statusDiv = document.getElementById("status");

    let roomId = null;
    let playerId = null;
    let hand = [];
    let trump = null;

    // ---------- Play button ----------
    playBtn.onclick = () => {
      socket.emit("play");
      playBtn.disabled = true;
      lobbyStatus.textContent = "–ñ–¥–µ–º –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤...";
    };

    // ---------- Waiting ----------
    socket.on("waiting", data => {
      lobbyStatus.textContent = `–ñ–¥–µ–º –∏–≥—Ä–æ–∫–æ–≤: ${data.count}/${data.needed}`;
    });

    // ---------- Room joined ----------
    socket.on("room_joined", data => {
      roomId = data.roomId;
      playerId = socket.id;
      console.log("Joined room:", roomId, "as", playerId);
    });

    // ---------- Game started ----------
    socket.on("game_started", () => {
      lobbyStatus.style.display = "none";
      gameDiv.style.display = "block";
      statusDiv.textContent = "–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!";
      tableDiv.innerHTML = "";
      handDiv.innerHTML = "";
    });

    // ---------- Ask round ----------
    socket.on("ask_round", data => {
      statusDiv.textContent = data.message;
    });

    // ---------- Round started ----------
    socket.on("round_started", data => {
      statusDiv.textContent = data.message;
    });

    // ---------- Receive cards ----------
    socket.on("your_cards", data => {
      hand = data.hand;
      trump = data.trump;
      renderHand();
      renderStatus(`–¢—É–∑: ${trump} ‚ô†`);
    });

    // ---------- Card played ----------
    socket.on("card_played", data => {
      const cardEl = document.createElement("div");
      cardEl.className = "card";
      cardEl.textContent = data.card;
      tableDiv.appendChild(cardEl);
    });

    // ---------- Trick winner ----------
    socket.on("trick_winner", data => {
      renderStatus(`–•–æ–¥ –≤—ã–∏–≥—Ä–∞–ª: ${data.winnerId}`);
      tableDiv.innerHTML = "";
    });

    // ---------- Your turn ----------
    socket.on("your_turn", data => {
      renderStatus(data.message);
    });

    // ---------- Game ended ----------
    socket.on("game_ended", data => {
      renderStatus(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${data.winnerId}`);
      handDiv.innerHTML = "";
      tableDiv.innerHTML = "";
    });

    // ---------- Render hand ----------
    function renderHand() {
      handDiv.innerHTML = "";
      hand.forEach(card => {
        const cardEl = document.createElement("div");
        cardEl.className = "card";
        cardEl.textContent = card;
        cardEl.onclick = () => playCard(card);
        handDiv.appendChild(cardEl);
      });
    }

    function playCard(card) {
      socket.emit("play_card", { roomId, card });
      // –∫–∞—Ä—Ç–∞ ”©–∑ “õ–æ–ª—ã–Ω–∞–Ω ”©—à—ñ—Ä—ñ–ª–µ–¥—ñ, UI –∂–∞“£–∞—Ä—Ç—ã–ª–∞–¥—ã
      hand = hand.filter(c => c !== card);
      renderHand();
    }

    function renderStatus(text) {
      statusDiv.textContent = text;
    }
  </script>
</body>
</html>
