<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>–û–Ω–ª–∞–π–Ω –µ–∫—ñ –æ–π—ã–Ω—à—ã –º—ã—Å–∞–ª—ã</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body { font-family: Arial; text-align:center; background:#2e7d32; color:white; margin:0; padding:0; }
h1 { margin-top: 30px; }
#lobby { margin-top:50px; }
#game { display:none; position:relative; width:800px; height:500px; margin:30px auto; background:#1b5e20; border-radius:20px; box-shadow:0 0 25px #000; padding-top:20px; }
.opponent-card, .player-card { width:100px; height:150px; border-radius:12px; display:inline-block; margin:10px; box-shadow:0 0 8px #000; }
.opponent-card { background:#fff; transform:rotateX(180deg); }
.player-card { background:#ccc; }
#trump-card { width:80px; height:120px; background:gold; color:black; border-radius:8px; display:inline-block; font-size:24px; line-height:120px; font-weight:bold; box-shadow:0 0 8px #000; margin-top:20px; }
#infoGame, #opponent, #player-cards, #betDiv, #responderDiv { font-size:20px; font-weight:bold; color:white; margin-top:10px; }
button { padding:12px 20px; font-size:18px; cursor:pointer; border-radius:8px; border:none; background:#4caf50; color:white; transition:0.3s; }
button:hover { background:#66bb6a; }
input[type=number] { width:60px; padding:5px; font-size:18px; border-radius:5px; border:none; text-align:center; }
</style>
</head>
<body>

<h1>–û–Ω–ª–∞–π–Ω –µ–∫—ñ –æ–π—ã–Ω—à—ã –º—ã—Å–∞–ª—ã</h1>

<div id="lobby">
  <div id="info">–û–π—ã–Ω“ì–∞ “õ–æ—Å—ã–ª—É “Ø—à—ñ–Ω –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑</div>
  <button id="joinBtn">–û–π—ã–Ω“ì–∞ “õ–æ—Å—ã–ª—É</button>
</div>

<div id="game">
  <div id="infoGame"></div>
  <div id="betDiv" style="display:none;">
    <span>–°—Ç–∞–≤–∫–∞: </span>
    <input type="number" id="betInput" min="25" max="150" value="25">
    <button id="betBtn">–ñ—ñ–±–µ—Ä—É</button>
  </div>
  <div id="responderDiv" style="display:none;">
    <span id="opponentBetText"></span><br>
    <button id="readyBtn">–ì–æ—Ç–æ–≤</button>
    <button id="foldBtn">–û—Ç–±–æ–π</button>
  </div>
  <div id="opponent">“ö–∞—Ä—Å—ã–ª–∞—Å –∫“Ø—Ç—ñ–ª—É–¥–µ...</div>
  <div id="trumpDiv"></div>
  <div id="player-cards"></div>
</div>

<script>
const joinBtn = document.getElementById("joinBtn");
const info = document.getElementById("info");
const lobby = document.getElementById("lobby");
const gameDiv = document.getElementById("game");
const infoGame = document.getElementById("infoGame");
const opponentDiv = document.getElementById("opponent");
const playerCardsDiv = document.getElementById("player-cards");
const trumpDiv = document.getElementById("trumpDiv");
const betDiv = document.getElementById("betDiv");
const betInput = document.getElementById("betInput");
const betBtn = document.getElementById("betBtn");
const responderDiv = document.getElementById("responderDiv");
const opponentBetText = document.getElementById("opponentBetText");
const readyBtn = document.getElementById("readyBtn");
const foldBtn = document.getElementById("foldBtn");

const socket = io();
let userId = Math.floor(Math.random()*1000);
let isStarter = false;

joinBtn.onclick = () => {
  socket.emit("joinGame", { userId });
  info.innerText = "‚è≥ –°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª—É–¥–∞...";
  joinBtn.disabled = true;
};

socket.on("message", (msg) => info.innerText = msg);

socket.on("opponentFound", ({ opponentId }) => {
  lobby.style.display = "none";
  gameDiv.style.display = "block";
  infoGame.innerText = `–û–π—ã–Ω –±–∞—Å—Ç–∞–ª–¥—ã! “ö–∞—Ä—Å—ã–ª–∞—Å: ${opponentId}`;

  if(userId < opponentId) { isStarter = true; betDiv.style.display="block"; }
  else responderDiv.style.display="block";
});

betBtn.onclick = () => {
  const bet = parseInt(betInput.value);
  socket.emit("playerBet",{bet});
  betDiv.style.display="none";
  infoGame.innerText=`–°—Ç–∞–≤–∫–∞ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ: ${bet}. “ö–∞—Ä—Å—ã–ª–∞—Å –∫“Ø—Ç—ñ–ø —Ç“±—Ä...`;
};

socket.on("opponentBet",({bet})=>{
  opponentBetText.innerText=`“ö–∞—Ä—Å—ã–ª–∞—Å —Å—Ç–∞–≤–∫–∞—Å—ã–Ω —Ç–∞“£–¥–∞–¥—ã: ${bet}`;
  responderDiv.style.display="block";
});

readyBtn.onclick = ()=>{
  socket.emit("responderDecision",{decision:"–≥–æ—Ç–æ–≤"});
  responderDiv.style.display="none";
};
foldBtn.onclick = ()=>{
  socket.emit("responderDecision",{decision:"–æ—Ç–±–æ–π"});
  responderDiv.style.display="none";
};

socket.on("dealCards", ({ playerCards, opponentCardsCount, trump }) => {
  opponentDiv.innerHTML='';
  for(let i=0;i<opponentCardsCount;i++){
    const c=document.createElement("div");
    c.className="opponent-card"; c.innerText="üÇ†"; opponentDiv.appendChild(c);
  }
  playerCardsDiv.innerHTML='';
  for(const c of playerCards){
    const card=document.createElement("div"); card.className="player-card"; card.innerText=`${c.value}${c.suit}`;
    playerCardsDiv.appendChild(card);
  }
  trumpDiv.innerHTML=''; const t=document.createElement("div"); t.id="trump-card"; t.innerText=`${trump.value}${trump.suit}`;
  trumpDiv.appendChild(t);
});

socket.on("gameCanceled", ({message})=>{ alert(message); location.reload(); });
</script>

</body>
</html>
