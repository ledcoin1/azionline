<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>Lobby & Room</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #lobby, #room { margin-bottom: 20px; }
    button { padding: 5px 10px; margin-top: 10px; }
    .player { margin-bottom: 5px; }
  </style>
</head>
<body>

  <h1>üéÆ Lobby & Room</h1>

  <!-- Lobby -->
  <div id="lobby">
    <h2>Lobby-–¥–µ –∫“Ø—Ç—ñ–ø —Ç“±—Ä“ì–∞–Ω –æ–π—ã–Ω—à—ã–ª–∞—Ä:</h2>
    <div id="lobbyPlayers"></div>
    <button id="playBtn">–ò–≥—Ä–∞—Ç—å</button>
  </div>

  <!-- Room -->
  <div id="room" style="display:none;">
    <h2 id="roomTitle">Room</h2>
    <p id="roundInfo"></p>
    <div id="roomPlayers"></div>
    <div id="questionDiv" style="margin-top:15px;">
      <p id="questionText"></p>
      <button id="readyBtn" style="display:none;">–î–∞–π—ã–Ω–º—ã–Ω</button>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    let currentRoomId = null;

    // ===== Telegram user simulation =====
    const user = {
      id: Math.floor(Math.random() * 10000),
      username: "player_" + Math.floor(Math.random() * 1000),
      first_name: "–û–π—ã–Ω—à—ã" + Math.floor(Math.random() * 100)
    };

    socket.emit("telegram_user", user);

    // ===== Login success =====
    socket.on("login_success", (player) => {
      console.log("‚úÖ Login success:", player);
      updateLobby([player]); // –∞–ª–¥—ã“£“ì—ã –æ–π—ã–Ω—à—ã–Ω—ã –∫”©—Ä—Å–µ—Ç—É
    });

    // ===== Room joined =====
    socket.on("room_joined", (data) => {
      currentRoomId = data.roomId;
      document.getElementById("lobby").style.display = "none";
      document.getElementById("room").style.display = "block";

      document.getElementById("roomTitle").innerText = `üè† ${data.roomId}`;
      updateRoomPlayers(data.players);

      if (data.round !== undefined) {
        document.getElementById("roundInfo").innerText = `–†–∞—É–Ω–¥: ${data.round}`;
      }
    });

    // ===== Round question =====
    socket.on("round_question", (data) => {
      document.getElementById("roundInfo").innerText = `–†–∞—É–Ω–¥: ${data.round}`;
      document.getElementById("questionText").innerText = data.question;
      document.getElementById("readyBtn").style.display = "inline-block";
    });

    // ===== Ready button =====
    document.getElementById("readyBtn").addEventListener("click", () => {
      alert("–°—ñ–∑ –¥–∞–π—ã–Ω—Å—ã–∑!"); // –∫–µ—Ä–µ–∫ –±–æ–ª—Å–∞, —Å–µ—Ä–≤–µ—Ä–≥–µ –¥–µ –∂—ñ–±–µ—Ä—É–≥–µ –±–æ–ª–∞–¥—ã
      document.getElementById("readyBtn").style.display = "none";
    });

    // ===== Lobby update =====
    function updateLobby(players) {
      const div = document.getElementById("lobbyPlayers");
      div.innerHTML = "";
      players.forEach(p => {
        const pDiv = document.createElement("div");
        pDiv.className = "player";
        pDiv.innerText = p.first_name;
        div.appendChild(pDiv);
      });
    }

    // ===== Room update =====
    function updateRoomPlayers(players) {
      const div = document.getElementById("roomPlayers");
      div.innerHTML = "";
      players.forEach(p => {
        const pDiv = document.createElement("div");
        pDiv.className = "player";
        pDiv.innerText = p.first_name;
        div.appendChild(pDiv);
      });
    }

    // ===== Play button =====
    document.getElementById("playBtn").addEventListener("click", () => {
      // —Å–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—É —Å“±—Ä–∞—É—ã
      socket.emit("join_room");
      console.log("–ò–≥—Ä–∞—Ç—å –±–∞—Ç—ã—Ä–º–∞—Å—ã –±–∞—Å—ã–ª–¥—ã");
    });

  </script>
</body>
</html>
