<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>–û–π—ã–Ω - 1-2</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
    h1 { text-align: center; }
    #players { margin-bottom: 20px; display: flex; gap: 20px; }
    .player { border: 1px solid #ccc; border-radius: 10px; padding: 10px; width: 150px; background: #fff; }
    #log { border: 1px solid #ccc; border-radius: 10px; padding: 10px; height: 150px; overflow-y: auto; background: #fff; }
    #turn { font-weight: bold; margin: 10px 0; }
    input[type="number"] { width: 80px; padding: 5px; }
    button { padding: 5px 10px; margin-left: 5px; cursor: pointer; }
    #confirmButtons { display: none; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>–û–π—ã–Ω 1-2</h1>

  <div>
    <label>–ê—Ç—ã“£—ã–∑: <input type="text" id="nameInput"></label>
    <button id="joinBtn">“ö–æ—Å—ã–ª—É</button>
  </div>

  <div id="players"></div>

  <div id="turn"></div>

  <div id="choiceDiv">
    <input type="number" id="choiceInput" min="50" max="150">
    <button id="sendChoiceBtn">–ñ—ñ–±–µ—Ä—É</button>
  </div>

  <div id="confirmButtons">
    <button id="confirmBtn">–ö–µ–ª—ñ—Å–µ–º—ñ–Ω</button>
    <button id="declineBtn">–û—Ç–±–æ–π</button>
  </div>

  <h3>–õ–æ–≥:</h3>
  <div id="log"></div>

  <script>
    const socket = io();

    const nameInput = document.getElementById("nameInput");
    const joinBtn = document.getElementById("joinBtn");
    const playersDiv = document.getElementById("players");
    const logDiv = document.getElementById("log");
    const turnText = document.getElementById("turn");
    const choiceDiv = document.getElementById("choiceDiv");
    const choiceInput = document.getElementById("choiceInput");
    const sendChoiceBtn = document.getElementById("sendChoiceBtn");
    const confirmButtons = document.getElementById("confirmButtons");
    const confirmBtn = document.getElementById("confirmBtn");
    const declineBtn = document.getElementById("declineBtn");

    let myName = "";
    let myId = "";

    // “ö–æ—Å—ã–ª—É
    joinBtn.onclick = () => {
      myName = nameInput.value.trim();
      if (!myName) return alert("–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑");
      socket.emit("join", myName);
      nameInput.disabled = true;
      joinBtn.disabled = true;
    };

    // –û–π—ã–Ω—à—ã–ª–∞—Ä –∂–∞“£–∞—Ä—Ç—É
    socket.on("room_update", (data) => {
      playersDiv.innerHTML = "";
      data.players.forEach(p => {
        const div = document.createElement("div");
        div.className = "player";
        div.innerHTML = `<strong>${p.name}</strong><br>–ë–∞–ª–∞–Ω—Å: ${p.balance}`;
        playersDiv.appendChild(div);
      });
    });

    // –û–π—ã–Ω –±–∞—Å—Ç–∞–ª–¥—ã
    socket.on("game_started", (data) => {
      addLog("üî• –û–π—ã–Ω –±–∞—Å—Ç–∞–ª–¥—ã!");
      choiceDiv.style.display = "none";
      confirmButtons.style.display = "none";
      turnText.textContent = "";
    });

    // 1-—à—ñ –æ–π—ã–Ω—à—ã“ì–∞ —Å–∞–Ω —Ç–∞“£–¥–∞—É
    socket.on("your_turn", (data) => {
      turnText.textContent = data.message;
      choiceInput.value = "";
      choiceDiv.style.display = "block";
      sendChoiceBtn.disabled = false;
      confirmButtons.style.display = "none";
    });

    // 2-—à—ñ –∂”ô–Ω–µ 3-—à—ñ –æ–π—ã–Ω—à—ã“ì–∞ –±–∞—Ç—ã—Ä–º–∞
    socket.on("your_turn_button", (data) => {
      turnText.textContent = `–ê–ª–¥—ã“£“ì—ã —Å–∞–Ω: ${data.number} | –ë–∞–ª–∞–Ω—Å: ${data.balance}`;
      choiceDiv.style.display = "none";
      confirmButtons.style.display = "block";
    });

    // –õ–æ–≥ –∂–∞“£–∞—Ä—Ç—É
    socket.on("log_update", (data) => {
      addLog(data.msg);
    });

    // –ë–∞–ª–∞–Ω—Å –∂–∞“£–∞—Ä—Ç—É
    socket.on("balance_update", (data) => {
      playersDiv.innerHTML = "";
      data.players.forEach(p => {
        const div = document.createElement("div");
        div.className = "player";
        div.innerHTML = `<strong>${p.name}</strong><br>–ë–∞–ª–∞–Ω—Å: ${p.balance}`;
        playersDiv.appendChild(div);
      });
    });

    // –ñ—ñ–±–µ—Ä—É –±–∞—Ç—ã—Ä–º–∞—Å—ã
    sendChoiceBtn.onclick = () => {
      const number = parseInt(choiceInput.value);
      if (isNaN(number) || number < 50 || number > 150) return alert("50‚Äì150 –∞—Ä–∞—Å—ã–Ω–¥–∞ —Å–∞–Ω —Ç–∞“£–¥–∞“£—ã–∑");
      socket.emit("player_choice", { number });
      choiceDiv.style.display = "none";
    };

    // –ö–µ–ª—ñ—Å–µ–º—ñ–Ω / –û—Ç–±–æ–π
    confirmBtn.onclick = () => {
      socket.emit("player_confirm", { choice: "–ö–µ–ª—ñ—Å–µ–º—ñ–Ω" });
      confirmButtons.style.display = "none";
    };
    declineBtn.onclick = () => {
      socket.emit("player_confirm", { choice: "–û—Ç–±–æ–π" });
      confirmButtons.style.display = "none";
    };

    function addLog(msg) {
      const p = document.createElement("div");
      p.textContent = msg;
      logDiv.appendChild(p);
      logDiv.scrollTop = logDiv.scrollHeight;
    }
  </script>
</body>
</html>
