<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3 Player Card Game</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f0f0; }
  .player { border: 1px solid #ccc; padding: 10px; margin: 10px; background: #fff; }
  .cards { margin-top: 5px; }
  button { margin: 5px; padding: 5px 10px; }
  #game-log { border: 1px solid #aaa; padding: 10px; background: #fff; height: 200px; overflow-y: auto; margin: 10px 0; }
</style>
</head>
<body>

<h2>3 Player Card Game</h2>

<div>
  <input type="text" id="username" placeholder="Telegram username">
  <button id="joinBtn">Join Game</button>
</div>

<div id="players"></div>

<div id="your-info"></div>

<div id="actions" style="display:none;">
  <button id="acceptBtn">Accept</button>
  <button id="foldBtn">Fold</button>
</div>

<div id="your-cards" class="cards"></div>

<h3>Game Log</h3>
<div id="game-log"></div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  const socket = io();

  let myId = null;
  let myBalance = 0;

  const joinBtn = document.getElementById("joinBtn");
  const usernameInput = document.getElementById("username");
  const playersDiv = document.getElementById("players");
  const yourInfoDiv = document.getElementById("your-info");
  const actionsDiv = document.getElementById("actions");
  const acceptBtn = document.getElementById("acceptBtn");
  const foldBtn = document.getElementById("foldBtn");
  const yourCardsDiv = document.getElementById("your-cards");
  const gameLogDiv = document.getElementById("game-log");

  function log(msg) {
    const p = document.createElement("p");
    p.textContent = msg;
    gameLogDiv.appendChild(p);
    gameLogDiv.scrollTop = gameLogDiv.scrollHeight;
  }

  joinBtn.addEventListener("click", () => {
    const username = usernameInput.value.trim();
    if (!username) return alert("Enter username!");
    socket.emit("join", { telegramId: username, username });
    usernameInput.disabled = true;
    joinBtn.disabled = true;
  });

  socket.on("joined", (data) => {
    myBalance = data.balance;
    yourInfoDiv.textContent = `Ваш баланс: ${myBalance}`;
    log("You joined the game!");
    myId = socket.id;
  });

  socket.on("room_opened", (data) => {
    playersDiv.innerHTML = "<h3>Players in room:</h3>";
    data.players.forEach(p => {
      const div = document.createElement("div");
      div.className = "player";
      div.textContent = `${p.username} - Balance: ${p.balance}`;
      playersDiv.appendChild(div);
    });
    log("Room is opened! Waiting for round...");
  });

  socket.on("start_bet", (data) => {
    log(`Round started! Bet: ${data.bet}, Trump: ${data.trump.suit} ${data.trump.value}`);
    actionsDiv.style.display = "block";
  });

  socket.on("your_turn", (data) => {
    log(data.message);
    actionsDiv.style.display = "block";
  });

  acceptBtn.addEventListener("click", () => {
    socket.emit("player_accept");
    actionsDiv.style.display = "none";
    log("You pressed ACCEPT");
  });

  foldBtn.addEventListener("click", () => {
    socket.emit("player_fold");
    actionsDiv.style.display = "none";
    log("You pressed FOLD");
  });

  socket.on("player_accepted", (data) => {
    log(`${data.username} accepted the round`);
  });

  socket.on("player_folded", (data) => {
    log(`${data.username} folded`);
  });

  socket.on("your_cards", (data) => {
    yourCardsDiv.innerHTML = "<h4>Your Cards:</h4>";
    data.cards.forEach(card => {
      const span = document.createElement("span");
      span.textContent = `${card.value} of ${card.suit} `;
      yourCardsDiv.appendChild(span);
    });
    log("Cards have been dealt!");
  });
</script>

</body>
</html>
