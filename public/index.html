<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>Mini App Online</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #0f172a, #1e293b);
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 40px 20px;
    }

    h1 {
      font-size: 32px;
      margin-bottom: 20px;
      color: #22c55e;
    }

    button {
      padding: 15px 35px;
      font-size: 18px;
      border-radius: 12px;
      border: none;
      background: #22c55e;
      color: white;
      cursor: pointer;
      transition: transform 0.2s, background 0.2s;
      margin-top: 20px;
    }

    button:hover {
      background: #16a34a;
      transform: scale(1.05);
    }

    #main-screen, #game-screen {
      display: none;
    }

    #main-screen.active, #game-screen.active {
      display: block;
    }

    #players {
      margin-top: 20px;
      display: inline-block;
      text-align: left;
      padding: 10px;
      border: 2px solid #22c55e;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.3);
    }

    #hand {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 15px;
      perspective: 1000px;
    }

    .card {
      width: 80px;
      height: 120px;
      border-radius: 12px;
      background: #fefefe;
      color: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      box-shadow: 0 8px 15px rgba(0,0,0,0.3);
      transform: rotateY(0deg);
      transition: transform 0.5s, box-shadow 0.3s;
      cursor: pointer;
    }

    .card:hover {
      transform: rotateY(15deg) translateY(-10px);
      box-shadow: 0 15px 25px rgba(0,0,0,0.5);
    }

    #trump {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #facc15; /* —Å–∞—Ä—ã —Ç“Ø—Å–ø–µ–Ω –∫”©–∑—ñ—Ä */
    }

    #game-messages {
      margin-top: 20px;
      font-size: 18px;
      color: #38bdf8;
    }
  </style>
</head>
<body>

  <h1>Mini App Online</h1>

  <!-- –ù–µ–≥—ñ–∑–≥—ñ —ç–∫—Ä–∞–Ω -->
  <div id="main-screen" class="active">
    <p id="user">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</p>
    <button id="playBtn">–ò–≥—Ä–∞—Ç—å</button>
    <div id="messages"></div>
  </div>

  <!-- –û–π—ã–Ω —ç–∫—Ä–∞–Ω—ã -->
  <div id="game-screen">
    <h2>–ö–æ–º–Ω–∞—Ç–∞ –∞—à—ã–ª–¥—ã! üéÆ</h2>
    <p>–û–π—ã–Ω—à—ã–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ:</p>
    <ul id="players"></ul>

    <div id="hand-title"><h3>–°—ñ–∑–¥—ñ“£ “õ–æ–ª—ã“£—ã–∑:</h3></div>
    <div id="hand"></div>

    <div id="trump"></div>
    <div id="game-messages"></div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    const socket = io();

    const user = tg.initDataUnsafe.user;
    const playerName = user ? user.first_name : "–ê—Ç—ã –∂–æ“õ –æ–π—ã–Ω—à—ã";
    document.getElementById("user").innerText =
      user ? `–°”ô–ª–µ–º, ${user.first_name}` : "Telegram user –∂–æ“õ";

    const mainScreen = document.getElementById("main-screen");
    const gameScreen = document.getElementById("game-screen");
    const messagesDiv = document.getElementById("messages");
    const gameMessagesDiv = document.getElementById("game-messages");
    const playersList = document.getElementById("players");
    const handDiv = document.getElementById("hand");
    const trumpDiv = document.getElementById("trump");

    document.getElementById("playBtn").onclick = () => {
      socket.emit("join game", playerName);
      messagesDiv.innerText = "–°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª—É–¥–∞...";
    };

    socket.on("update players", (players) => {
      playersList.innerHTML = "";
      players.forEach(p => {
        const li = document.createElement("li");
        li.innerText = p.name;
        playersList.appendChild(li);
      });
    });

    socket.on("room started", (players) => {
      mainScreen.classList.remove("active");
      gameScreen.classList.add("active");
      gameMessagesDiv.innerText = "–û–π—ã–Ω –±–∞—Å—Ç–∞–ª–¥—ã! üéÆ";

      playersList.innerHTML = "";
      players.forEach(p => {
        const li = document.createElement("li");
        li.innerText = p.name;
        playersList.appendChild(li);
      });

      // üîπ –°—ñ–∑–¥—ñ“£ “õ–æ–ª—ã“£—ã–∑
      const me = players.find(p => p.name === playerName);
      if (me && me.hand) {
        handDiv.innerHTML = "";
        me.hand.forEach(card => {
          const div = document.createElement("div");
          div.className = "card";
          div.innerText = `${card.value}${card.suit[0].toUpperCase()}`; // –º—ã—Å–∞–ª—ã: 6H, KD
          handDiv.appendChild(div);
        });
      }

      // üîπ –ö”©–∑—ñ—Ä–¥—ñ –∫”©—Ä—Å–µ—Ç—É
      const anyPlayer = players.find(p => p.trump);
      if (anyPlayer) {
        trumpDiv.innerText = `–ö”©–∑—ñ—Ä: ${anyPlayer.trump.value}${anyPlayer.trump.suit[0].toUpperCase()}`;
      }
    });

    socket.on("error", (msg) => {
      messagesDiv.innerText = msg;
    });
  </script>

</body>
</html>
