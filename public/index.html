<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8">
<title>Telegram MiniApp Game</title>
<style>
body{font-family:Arial,sans-serif;background:#111;color:#fff;padding:20px;text-align:center;}
h2{margin-bottom:20px;}
#balance{margin-top:10px;font-size:18px;}
button{padding:6px 12px;margin-top:10px;cursor:pointer;}
</style>
</head>
<body>

<h2>Ойынға қош келдіңіз!</h2>
<div id="status">❌ Telegram MiniApp емес немесе API табылмады</div>
<div id="user">
  <div>Telegram ID: <span id="telegramId">...</span></div>
  <div id="balance">Баланс: 0</div>
</div>

<script>
const API = "https://azionline.onrender.com"; // сіздің сервер URL

async function init() {
  // Telegram MiniApp тексеру
  if(!window.Telegram?.WebApp) return;

  const tg = window.Telegram.WebApp;
  const userId = tg.initDataUnsafe?.user?.id; // Telegram ID

  if(!userId){
    document.getElementById("status").innerText = "❌ Telegram ID табылмады";
    return;
  }

  document.getElementById("telegramId").innerText = userId;
  document.getElementById("status").innerText = "✅ Telegram MiniApp табылды";

  // Серверге логин жасау
  try {
    const res = await fetch(API + "/api/login", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ telegramId: userId })
    });

    const data = await res.json();

    if(data.error){
      document.getElementById("status").innerText = "❌ " + data.error;
      return;
    }

    document.getElementById("balance").innerText = "Баланс: " + data.balance;

  } catch(err) {
    console.log(err);
    document.getElementById("status").innerText = "❌ Серверге қосылу қатесі";
  }
}

// Telegram MiniApp дайын болған соң init шақыру
window.addEventListener("load", init);
</script>

</body>
</html>
