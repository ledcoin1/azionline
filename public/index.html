<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–î—É—Ä–∞–∫ –û–Ω–ª–∞–π–Ω</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #f9f9f9, #c9f0ff);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      margin-top: 20px;
      color: #333;
    }

    #lobby, #round-question, #game-area {
      margin-top: 30px;
      width: 90%;
      max-width: 600px;
      text-align: center;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background-color: #4f46e5;
      color: white;
      margin: 5px;
      transition: 0.2s;
    }

    button:hover {
      background-color: #4338ca;
    }

    .cards {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .card {
      width: 60px;
      height: 90px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      margin: 5px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    }

    .trump {
      margin-top: 20px;
      font-size: 22px;
      color: #e11d48;
      font-weight: bold;
    }

    #messages {
      margin-top: 20px;
      font-size: 18px;
      color: #333;
      min-height: 30px;
    }

    .winner {
      font-size: 22px;
      color: green;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>–î—É—Ä–∞–∫ –û–Ω–ª–∞–π–Ω</h1>

  <!-- Lobby / Play button -->
  <div id="lobby">
    <button id="play-btn">–ò–≥—Ä–∞—Ç—å</button>
    <div id="waiting-msg"></div>
  </div>

  <!-- Round Question -->
  <div id="round-question" style="display:none;">
    <p>1 —Ä–∞—É–Ω–¥ –æ–π–Ω–∞–π–º—ã–∑ –±–∞?</p>
    <button id="round-yes">–ò”ô</button>
    <button id="round-no">–ñ–æ“õ</button>
  </div>

  <!-- Game Area -->
  <div id="game-area" style="display:none;">
    <div class="trump" id="trump-card"></div>
    <div class="cards" id="player-hand"></div>
    <div id="messages"></div>
  </div>

  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const playBtn = document.getElementById("play-btn");
    const waitingMsg = document.getElementById("waiting-msg");
    const roundQuestionDiv = document.getElementById("round-question");
    const roundYesBtn = document.getElementById("round-yes");
    const roundNoBtn = document.getElementById("round-no");
    const gameArea = document.getElementById("game-area");
    const playerHandDiv = document.getElementById("player-hand");
    const messagesDiv = document.getElementById("messages");
    const trumpDiv = document.getElementById("trump-card");

    let myId = null;
    let roomId = null;
    let myHand = [];

    // ---------- PLAY BUTTON ----------
    playBtn.addEventListener("click", () => {
      socket.emit("play");
      waitingMsg.textContent = "–ö“Ø—Ç—ñ–ø —Ç“±—Ä...";
    });

    // ---------- WAITING ----------
    socket.on("waiting", ({count, needed}) => {
      waitingMsg.textContent = `Lobby: ${count}/${needed} –æ–π—ã–Ω—à—ã –∂–∏–Ω–∞–ª–¥—ã`;
    });

    // ---------- ROOM JOINED ----------
    socket.on("room_joined", (data) => {
      myId = socket.id;
      roomId = data.roomId;
      waitingMsg.textContent = `Room: ${roomId}, –æ–π—ã–Ω—à—ã–ª–∞—Ä –¥–∞–π—ã–Ω!`;
    });

    // ---------- ASK ROUND ----------
    socket.on("ask_round", (data) => {
      roundQuestionDiv.style.display = "block";
    });

    roundYesBtn.addEventListener("click", () => {
      socket.emit("round_answer", { roomId, answer:true });
      roundQuestionDiv.style.display = "none";
      messagesDiv.textContent = "–ö“Ø—Ç—ñ–ø —Ç“±—Ä...";
    });

    roundNoBtn.addEventListener("click", () => {
      socket.emit("round_answer", { roomId, answer:false });
      roundQuestionDiv.style.display = "none";
      messagesDiv.textContent = "–°—ñ–∑ –±–∞—Å —Ç–∞—Ä—Ç—Ç—ã“£—ã–∑!";
    });

    // ---------- ROUND STARTED ----------
    socket.on("round_started", (data) => {
      messagesDiv.textContent = "–†–∞—É–Ω–¥ –±–∞—Å—Ç–∞–ª–¥—ã!";
      gameArea.style.display = "block";
    });

    // ---------- RECEIVE CARDS ----------
    socket.on("your_cards", ({hand, trump}) => {
      myHand = hand;
      trumpDiv.textContent = "Trump: " + trump;
      playerHandDiv.innerHTML = "";
      hand.forEach(card => {
        const cardEl = document.createElement("div");
        cardEl.classList.add("card");
        cardEl.textContent = card;
        cardEl.addEventListener("click", () => {
          socket.emit("play_card", { roomId, card });
          cardEl.remove();
        });
        playerHandDiv.appendChild(cardEl);
      });
    });

    // ---------- CARD PLAYED ----------
    socket.on("card_played", ({playerId, card}) => {
      messagesDiv.textContent = `–û–π—ã–Ω—à—ã ${playerId} –∫–∞—Ä—Ç–∞ –æ–π–Ω–∞–¥—ã: ${card}`;
    });

    // ---------- TRICK WINNER ----------
    socket.on("trick_winner", ({winnerId, tricksWon}) => {
      messagesDiv.textContent = `üèÜ ${winnerId} –∂“Ø—Ä—ñ—Å—Ç—ñ “±—Ç—Ç—ã!`;
    });

    // ---------- YOUR TURN ----------
    socket.on("your_turn", (data) => {
      messagesDiv.textContent = data.message;
    });

    // ---------- GAME ENDED ----------
    socket.on("game_ended", ({winnerId, message}) => {
      messagesDiv.textContent = message;
    });

  </script>
</body>
</html>
