<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>üÉè –ê–ó–ò –û–Ω–ª–∞–π–Ω</title>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      font-family: Arial;
      text-align: center;
      padding-top: 40px;
    }
    button {
      font-size: 18px;
      padding: 15px 30px;
    }
  </style>
</head>
<body>

<h2>üÉè –ê–ó–ò (3 –∫–∞—Ä—Ç–∞)</h2>

<div id="info">–û–π—ã–Ω“ì–∞ –∫—ñ—Ä—ñ“£—ñ–∑</div>
<br>
<button id="join">–û–π—ã–Ω“ì–∞ –∫—ñ—Ä—É</button>

<script>
  // –¢–µ–∫ Telegram
  if (!window.Telegram || !Telegram.WebApp.initData) {
    document.body.innerHTML = "‚ùå –¢–µ–∫ Telegram –∞—Ä“õ—ã–ª—ã –∞—à—ã–ª–∞–¥—ã";
    throw new Error("Not Telegram");
  }

  const user = Telegram.WebApp.initDataUnsafe.user;
  const userId = user.id;

  const socket = io();

  const info = document.getElementById("info");
  const btn = document.getElementById("join");

  btn.onclick = () => {
    btn.disabled = true;
    socket.emit("joinGame", { userId });
  };

  socket.on("waiting", data => {
    info.innerHTML = `
      ‚è≥ “ö–∞—Ä—Å—ã–ª–∞—Å –∫“Ø—Ç—ñ–ª—É–¥–µ...<br>
      üí∞ –ë–∞–ª–∞–Ω—Å: ${data.balance}
    `;
  });

  socket.on("gameStarted", data => {
    const myCards = data.cards[userId];
    const myScore = data.scores[userId];

    const enemyId = data.players.find(id => id != userId);
    const enemyScore = data.scores[enemyId];

    let result = "ü§ù –¢–ï“¢";
    if (myScore > enemyScore) result = "üèÜ –°–ï–ù –ñ–ï“¢–î–Ü“¢";
    if (myScore < enemyScore) result = "‚ùå –°–ï–ù “∞–¢–´–õ–î–´“¢";

    info.innerHTML = `
      üÉè –ê–ó–ò –û–ô–´–ù–´<br><br>

      üë§ –°–µ–Ω—ñ“£ –∫–∞—Ä—Ç–∞–ª–∞—Ä—ã“£:<br>
      <b>${myCards.join(" , ")}</b><br><br>

      üî¢ –°–µ–Ω—ñ“£ “±–ø–∞–π—ã“£: <b>${myScore}</b><br>
      üßë “ö–∞—Ä—Å—ã–ª–∞—Å “±–ø–∞–π—ã: <b>${enemyScore}</b><br><br>

      <h3>${result}</h3>
    `;
  });
</script>

</body>
</html>
