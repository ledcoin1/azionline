<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>üÉè –û–Ω–ª–∞–π–Ω –û–π—ã–Ω</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { font-family: Arial; text-align:center; background:#2e7d32; color:white; }
  #lobby, #game { margin-top:50px; }
  #table { width: 500px; height: 300px; background:#388e3c; margin:20px auto; border-radius:15px; position:relative; }
  .card { width: 60px; height: 90px; background:white; color:black; border-radius:8px; line-height:90px; text-align:center; font-weight:bold; position:absolute; }
  #myCards { margin-top:20px; }
  button { padding:10px 20px; font-size:16px; margin:5px; }
</style>
</head>
<body>

<h1>üÉè –û–Ω–ª–∞–π–Ω –î—É—Ä–∞–∫ / –ê–ó–ò</h1>

<div id="lobby">
  <div id="info">–û–π—ã–Ω“ì–∞ “õ–æ—Å—ã–ª—É “Ø—à—ñ–Ω –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑</div>
  <button id="joinBtn">–û–π—ã–Ω“ì–∞ “õ–æ—Å—ã–ª—É</button>
</div>

<div id="game" style="display:none;">
  <div id="table"></div>
  <div id="myCards"></div>
</div>

<script>
const socket = io();
const info = document.getElementById("info");
const joinBtn = document.getElementById("joinBtn");
const lobby = document.getElementById("lobby");
const gameDiv = document.getElementById("game");
const tableDiv = document.getElementById("table");
const myCardsDiv = document.getElementById("myCards");

// –¢–µ—Å—Ç “Ø—à—ñ–Ω –∫–µ–∑–¥–µ–π—Å–æ“õ userId
const userId = Math.floor(Math.random()*1000);

joinBtn.onclick = () => {
  socket.emit("joinGame", { userId });
  joinBtn.disabled = true;
  info.innerText = "‚è≥ “ö–∞—Ä—Å—ã–ª–∞—Å –∫“Ø—Ç—ñ–ª—É–¥–µ...";
};

// –°–µ—Ä–≤–µ—Ä —Ö–∞–±–∞—Ä–ª–∞—Ä—ã–Ω –∞–ª—É
socket.on("message", msg => {
  info.innerText = msg;
});

// “ö–∞—Ä—Å—ã–ª–∞—Å —Ç–∞–±—ã–ª—Å–∞ ‚Üí –æ–π—ã–Ω —Ç–µ—Ä–µ–∑–µ—Å—ñ–Ω –∫”©—Ä—Å–µ—Ç—É
socket.on("startGame", ({ opponentId }) => {
  lobby.style.display = "none";
  gameDiv.style.display = "block";

  info.innerText = `–°—ñ–∑ –æ–π—ã–Ω“ì–∞ “õ–æ—Å—ã–ª–¥—ã“£—ã–∑! “ö–∞—Ä—Å—ã–ª–∞—Å: ${opponentId}`;

  // Dummy –∫–∞—Ä—Ç–∞–ª–∞—Ä
  const myCards = ["6‚ô†","7‚ô•","10‚ô¶"];
  myCardsDiv.innerHTML = "";
  myCards.forEach((c,i) => {
    const cardBtn = document.createElement("button");
    cardBtn.innerText = c;
    cardBtn.onclick = () => playCard(c, i);
    myCardsDiv.appendChild(cardBtn);
  });

  // “Æ—Å—Ç–µ–ª–≥–µ “õ–∞—Ä—Å—ã–ª–∞—Å –∫–∞—Ä—Ç–∞—Å—ã (“õ–∞–∑—ñ—Ä –∂–∞—Å—ã—Ä—ã–Ω)
  const opponentCard = document.createElement("div");
  opponentCard.classList.add("card");
  opponentCard.style.top = "20px";
  opponentCard.style.left = "220px";
  opponentCard.innerText = "?";
  tableDiv.appendChild(opponentCard);
});

function playCard(card, index){
  // –ö–∞—Ä—Ç–∞–Ω—ã “Ø—Å—Ç–µ–ª–≥–µ “õ–æ—é
  const cardDiv = document.createElement("div");
  cardDiv.classList.add("card");
  cardDiv.style.bottom = "10px";
  cardDiv.style.left = `${100 + index*70}px`;
  cardDiv.innerText = card;
  tableDiv.appendChild(cardDiv);

  // –ö–∞—Ä—Ç–∞ “õ–æ–ª–¥–∞–Ω –∂–æ–π—ã–ª–∞–¥—ã
  myCardsDiv.children[index].disabled = true;

  // –°–µ—Ä–≤–µ—Ä–≥–µ —Ö–∞–±–∞—Ä –∂—ñ–±–µ—Ä—É–≥–µ –±–æ–ª–∞–¥—ã (–∫–µ–π—ñ–Ω —Ç–æ–ª—ã“õ –ª–æ–≥–∏–∫–∞)
  console.log("–ö–∞—Ä—Ç–∞ –æ–π–Ω–∞–ª–¥—ã:", card);
}
</script>

</body>
</html>
