<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8">
<title>Telegram MiniApp Game</title>
<style>
  body { font-family: Arial; background: #111; color: #fff; padding: 20px; }
  h2 { text-align:center; }
  ul { list-style: none; padding: 0; }
  li { margin: 5px 0; }
</style>
</head>
<body>

<h2>üÉè –û–Ω–ª–∞–π–Ω –û–π—ã–Ω</h2>
<p>–°—ñ–∑–¥—ñ“£ –±–∞–ª–∞–Ω—Å: <span id="balance">0</span></p>

<h3>Lobby-–¥–µ –∞“ì—ã–º–¥–∞“ì—ã –æ–π—ã–Ω—à—ã–ª–∞—Ä:</h3>
<ul id="lobbyList"></ul>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
(async function() {

  const API = "https://azionline.onrender.com"; // –°—ñ–∑–¥—ñ“£ —Å–µ—Ä–≤–µ—Ä
  const socket = io(API);

  // Telegram MiniApp –∞—Ä“õ—ã–ª—ã “õ–æ–ª–¥–∞–Ω—É—à—ã–Ω—ã –∞–ª—É
  const tgWebApp = window.Telegram?.WebApp;

  if (!tgWebApp) {
    alert("‚ùå Telegram MiniApp –µ–º–µ—Å –Ω–µ–º–µ—Å–µ API —Ç–∞–±—ã–ª–º–∞–¥—ã");
    return;
  }

  tgWebApp.ready();

  const tgUser = tgWebApp.initDataUnsafe?.user;
  if (!tgUser) {
    alert("‚ùå Telegram ID —Ç–∞–±—ã–ª–º–∞–¥—ã");
    return;
  }

  const telegramId = tgUser.id.toString();

  // üîπ –°–µ—Ä–≤–µ—Ä–≥–µ login –∂–∞—Å–∞—É
  let userData;
  try {
    const res = await fetch(API + "/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ telegramId })
    });
    userData = await res.json();
    document.getElementById("balance").innerText = userData.balance;
  } catch (err) {
    console.error("Login error:", err);
    alert("–°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª–∞ –∞–ª–º–∞–π —Ç“±—Ä");
    return;
  }

  // üîπ Socket.IO –∞—Ä“õ—ã–ª—ã lobby-–≥–µ “õ–æ—Å—É
  socket.emit("joinLobby", telegramId);

  // üîπ Lobby –∂–∞“£–∞—Ä—Ç—É–ª–∞—Ä—ã–Ω –∞–ª—É
  socket.on("lobbyUpdate", (players) => {
    const ul = document.getElementById("lobbyList");
    ul.innerHTML = "";
    players.forEach(p => {
      ul.innerHTML += `<li>${p.telegramId} ‚Äî –ë–∞–ª–∞–Ω—Å: ${p.balance}</li>`;
    });
  });

})();
</script>

</body>
</html>
