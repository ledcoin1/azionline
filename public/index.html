<!DOCTYPE html>
<html>
<head>
  <title>MiniApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="/socket.io/socket.io.js"></script> <!-- Socket.IO ĞºĞ»Ğ¸ĞµĞ½Ñ‚ -->
</head>
<body>

<h2 id="info">Ğ–Ò¯ĞºÑ‚ĞµĞ»ÑƒĞ´Ğµ...</h2>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const user = tg.initDataUnsafe?.user;

if(!user){
  document.getElementById("info").innerText = "âŒ Telegram user Ñ‚Ğ°Ğ±Ñ‹Ğ»Ğ¼Ğ°Ğ´Ñ‹";
}else{
  // 1ï¸âƒ£ ĞĞ»Ğ´Ñ‹Ğ¼ĞµĞ½ login API
  fetch("/api/login", {
    method: "POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ telegramId: String(user.id) })
  })
  .then(r => r.json())
  .then(data => {

    // 2ï¸âƒ£ Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ´ĞµĞ½ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ°Ğ»Ò“Ğ°Ğ½Ğ½Ğ°Ğ½ ĞºĞµĞ¹Ñ–Ğ½ Socket Ò›Ğ¾ÑÑƒ
    const socket = io("/", {
      auth: { telegramId: String(user.id) }
    });

    // Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ´ĞµĞ½ Ğ¶Ğ°Ò£Ğ° Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ĞºĞµĞ»Ğ³ĞµĞ½Ğ´Ğµ ĞºÓ©Ñ€ÑĞµÑ‚Ñƒ
    socket.on("balance", balance => {
      document.getElementById("info").innerText =
        "ğŸ†” ID: " + data.telegramId + "\nğŸ’° Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ: " + balance;
    });

    // ĞĞ»Ò“Ğ°ÑˆÒ›Ñ‹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ÑĞºÑ€Ğ°Ğ½Ò“Ğ° ÑˆÑ‹Ò“Ğ°Ñ€Ñƒ
    document.getElementById("info").innerText =
      "ğŸ†” ID: " + data.telegramId + "\nğŸ’° Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ: " + data.balance;

  });
}
</script>

</body>
</html>
