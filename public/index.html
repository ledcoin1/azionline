<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–ê–ó–ò 3 –ö–ê–†–¢–ê</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial; text-align:center; padding:20px;}
    button { padding:10px 20px; font-size:18px; margin:3px; }
  </style>
</head>
<body>

<h2>üÉè –ê–ó–ò (3 –∫–∞—Ä—Ç–∞)</h2>
<div id="info"></div>
<div id="hand"></div>

<script>
if (!window.Telegram) { document.body.innerHTML = "–¢–µ–∫ Telegram!"; throw ""; }

const userId = Telegram.WebApp.initDataUnsafe.user.id;
const socket = io();
let roomId = null;

const info = document.getElementById("info");
const handDiv = document.getElementById("hand");

socket.emit("joinGame", { userId });

socket.on("waiting", () => {
  info.innerText = "‚è≥ “ö–∞—Ä—Å—ã–ª–∞—Å –∫“Ø—Ç—ñ–ª—É–¥–µ...";
});

function render(room) {
  roomId = roomId || Object.keys(room.hands)[0];
  info.innerHTML = `–ö”©–∑—ñ—Ä: ${room.trump} | –ö–µ–∑–µ–∫: ${room.turn===userId?"–°–µ–Ω—ñ“£ –∫–µ–∑–µ–≥—ñ“£":"“ö–∞—Ä—Å—ã–ª–∞—Å –∫–µ–∑–µ–∫"}`;

  handDiv.innerHTML = "";

  if (room.turn !== userId) return;

  room.hands[userId].forEach((c,i) => {
    const btn = document.createElement("button");
    btn.innerText = `${c.suit}${c.value}`;
    btn.onclick = () => socket.emit("playCard", { roomId, userId, cardIndex: i });
    handDiv.appendChild(btn);
  });
}

socket.on("start", render);
socket.on("update", render);

socket.on("gameEnd", tricks => {
  const other = Object.keys(tricks).find(p=>p!=userId);
  let result = tricks[userId] > tricks[other] ? "üèÜ –ñ–ï“¢–î–Ü“¢" :
               tricks[userId] < tricks[other] ? "‚ùå “∞–¢–´–õ–î–´“¢" : "ü§ù –¢–ï“¢";
  info.innerHTML = `–û–π—ã–Ω –∞—è“õ—Ç–∞–ª–¥—ã!<br>–°–µ–Ω: ${tricks[userId]}, “ö–∞—Ä—Å—ã–ª–∞—Å: ${tricks[other]}<br><h2>${result}</h2>`;
  handDiv.innerHTML = "";
});
</script>

</body>
</html>
