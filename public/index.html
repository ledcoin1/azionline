<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Telegram MiniApp Game</title>
<style>
body { font-family: Arial; background: #111; color: #fff; padding: 20px; text-align:center; }
h1 { color: #0f0; }
#error { color: red; margin: 20px 0; }
#info { margin-top: 20px; }
</style>
</head>
<body>

<h1>Ойынға қош келдіңіз!</h1>
<div id="error"></div>
<div id="info">
  <p>Telegram ID: <span id="telegramId">...</span></p>
  <p>Баланс: <span id="balance">0</span></p>
</div>

<script>
(async () => {
  const tg = window.Telegram?.WebApp;

  // Telegram API бар ма тексеру
  if (!tg) {
    document.getElementById("error").innerText = "❌ Telegram MiniApp емес немесе API табылмады";
    return;
  }

  // Telegram қолданушыны алу
  const user = tg.initDataUnsafe?.user;
  if (!user) {
    document.getElementById("error").innerText = "❌ Telegram ID табылмады";
    return;
  }

  const telegramId = user.id.toString();
  document.getElementById("telegramId").innerText = telegramId;

  try {
    // Серверге логин жасау
    const res = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ telegramId })
    });

    const data = await res.json();
    if (data.error) {
      document.getElementById("error").innerText = "❌ " + data.error;
      return;
    }

    // Баланс көрсету
    document.getElementById("balance").innerText = data.balance;

  } catch (err) {
    console.log(err);
    document.getElementById("error").innerText = "❌ Серверге қосылу қатесі";
  }
})();
</script>

</body>
</html>
