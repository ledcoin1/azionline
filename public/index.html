<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>3 Card Game</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #lobby, #round, #cards { margin-bottom: 20px; }
    .card { display: inline-block; padding: 10px 20px; margin: 5px; border: 1px solid #000; cursor: pointer; }
    .disabled { opacity: 0.5; cursor: not-allowed; }
    #messages { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>3 Card Game</h1>

  <!-- Lobby -->
  <div id="lobby">
    <button id="playBtn">Ойнау</button>
    <p id="waitingText"></p>
  </div>

  <!-- Round ask -->
  <div id="round" style="display:none;">
    <p id="roundMessage"></p>
    <button id="yesBtn">Иә</button>
    <button id="noBtn">Жоқ</button>
  </div>

  <!-- Cards -->
  <div id="cards" style="display:none;">
    <p id="turnMessage"></p>
    <div id="hand"></div>
    <p id="trump"></p>
  </div>

  <!-- Spectator -->
  <div id="spectator" style="display:none;">
    <p>Сіз spectator болдыңыз, ойыншыны көресіз</p>
    <p id="spectatorTrump"></p>
  </div>

  <!-- Messages -->
  <div id="messages"></div>

<script>
const socket = io();

// ---------- Play button ----------
const playBtn = document.getElementById("playBtn");
playBtn.onclick = () => {
  socket.emit("play");
  playBtn.disabled = true;
  document.getElementById("waitingText").innerText = "Lobby-ге қосылдыңыз, күтіңіз...";
};

// ---------- Waiting ----------
socket.on("waiting", data => {
  document.getElementById("waitingText").innerText = `Қазір lobby-де ${data.count} адам, кем дегенде ${data.needed} керек.`;
});

// ---------- Room joined ----------
socket.on("room_joined", data => {
  console.log("Room joined:", data);
});

// ---------- Game started ----------
socket.on("game_started", data => {
  console.log("Game started:", data);
});

// ---------- Ask round ----------
socket.on("ask_round", data => {
  document.getElementById("roundMessage").innerText = data.message;
  document.getElementById("round").style.display = "block";
});

// ---------- Round buttons ----------
document.getElementById("yesBtn").onclick = () => {
  socket.emit("round_answer", { roomId: currentRoom, answer: true });
  document.getElementById("round").style.display = "none";
};
document.getElementById("noBtn").onclick = () => {
  socket.emit("round_answer", { roomId: currentRoom, answer: false });
  document.getElementById("round").style.display = "none";
};

// ---------- Store current room ----------
let currentRoom = null;
socket.on("room_joined", data => {
  currentRoom = data.roomId;
});

// ---------- Your cards ----------
socket.on("your_cards", data => {
  document.getElementById("cards").style.display = "block";
  document.getElementById("hand").innerHTML = "";
  data.hand.forEach(card => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerText = card;
    div.onclick = () => {
      if (!div.classList.contains("disabled")) {
        socket.emit("play_card", { roomId: currentRoom, card });
        div.classList.add("disabled");
      }
    };
    document.getElementById("hand").appendChild(div);
  });
  document.getElementById("trump").innerText = "Trump: " + data.trump;
});

// ---------- Spectator ----------
socket.on("spectator", data => {
  document.getElementById("spectator").style.display = "block";
  document.getElementById("spectatorTrump").innerText = "Trump: " + data.trump;
});

// ---------- Turn ----------
socket.on("your_turn", data => {
  document.getElementById("turnMessage").innerText = data.message;
});

// ---------- Card played ----------
socket.on("card_played", data => {
  const msg = document.createElement("p");
  msg.innerText = `${data.playerId} ойнады: ${data.card}`;
  document.getElementById("messages").appendChild(msg);
});

// ---------- Trick winner ----------
socket.on("trick_winner", data => {
  const msg = document.createElement("p");
  msg.innerText = `Trick жеңді: ${data.winnerId}`;
  document.getElementById("messages").appendChild(msg);
});

// ---------- Round ended ----------
socket.on("round_ended", data => {
  const msg = document.createElement("p");
  msg.innerText = `Раунд аяқталды! Жеңімпаз: ${data.winnerId}, банк: ${data.bank}`;
  document.getElementById("messages").appendChild(msg);

  // Баланстар жаңартылады
  console.log("Balances:", data.balances);

  // Келесі раундқа дайындық
  document.getElementById("cards").style.display = "none";
});
</script>
</body>
</html>
