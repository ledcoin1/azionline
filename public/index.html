<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>–û–Ω–ª–∞–π–Ω –î—É—Ä–∞–∫</title>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      font-family: Arial;
      text-align: center;
      padding-top: 40px;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h2>üÉè –û–Ω–ª–∞–π–Ω –î—É—Ä–∞–∫</h2>

<div id="info">–û–π—ã–Ω“ì–∞ –∫—ñ—Ä—ñ“£—ñ–∑</div>
<br>
<button id="joinBtn">–û–π—ã–Ω“ì–∞ –∫—ñ—Ä—É</button>

<script>
  // ‚ùó Telegram —Ç–µ–∫—Å–µ—Ä—É
  if (!window.Telegram || !Telegram.WebApp.initData) {
    document.body.innerHTML = "‚ùå –¢–µ–∫ Telegram –∞—Ä“õ—ã–ª—ã –∞—à—ã–ª–∞–¥—ã";
    throw new Error("Not Telegram");
  }

  const user = Telegram.WebApp.initDataUnsafe.user;
  const userId = user.id;

  const socket = io();

  const info = document.getElementById("info");
  const btn = document.getElementById("joinBtn");

  btn.onclick = () => {
    btn.disabled = true;
    socket.emit("joinGame", { userId });
  };

  socket.on("waiting", data => {
    info.innerHTML = `
      ‚è≥ “ö–∞—Ä—Å—ã–ª–∞—Å –∫“Ø—Ç—ñ–ª—É–¥–µ...<br>
      üí∞ –ë–∞–ª–∞–Ω—Å: ${data.balance}
    `;
  });

  socket.on("gameStarted", data => {
    info.innerHTML = `
      ‚úÖ –ö–æ–º–Ω–∞—Ç–∞: ${data.roomId}<br><br>
      üë• –û–π—ã–Ω—à—ã–ª–∞—Ä:<br>
      ${data.players.map(id =>
        `ID: ${id} ‚Äî üí∞ ${data.balances[id]}`
      ).join("<br>")}
    `;
  });
</script>

</body>
</html>
