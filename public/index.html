<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üÉè Telegram Card Game</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #2e7d32; /* –∂–∞—Å—ã–ª “Ø—Å—Ç–µ–ª */
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  h1 { margin: 20px 0; }
  #lobby, #round, #game, #winner { margin-top: 20px; }
  button { padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; border: none; font-size: 16px; }
  #cards { display: flex; gap: 10px; margin-top: 20px; }
  .card { width: 60px; height: 90px; background: #fff; color: #000; display: flex; justify-content: center; align-items: center; border-radius: 5px; font-weight: bold; cursor: pointer; }
  .card.disabled { opacity: 0.5; cursor: default; }
  #center-cards { display: flex; gap: 10px; margin-top: 20px; }
  .center-card { width: 60px; height: 90px; background: #fff; color: #000; display: flex; justify-content: center; align-items: center; border-radius: 5px; font-weight: bold; }
  #players { margin-top: 20px; display: flex; gap: 20px; }
  .player { text-align: center; }
</style>
</head>
<body>

<h1>üÉè Telegram Card Game</h1>

<div id="lobby">
  <button id="playBtn">–ò–≥—Ä–∞—Ç—å</button>
  <div id="waitingMsg"></div>
</div>

<div id="round" style="display:none;">
  <p id="roundMsg"></p>
  <button id="yesBtn">–ò—è</button>
  <button id="noBtn">–ñ–æ“õ</button>
</div>

<div id="game" style="display:none;">
  <h2>–°—ñ–∑–¥—ñ“£ –∫–∞—Ä—Ç–∞–ª–∞—Ä—ã“£—ã–∑</h2>
  <div id="cards"></div>

  <h2>–û—Ä—Ç–∞–ª—ã“õ—Ç–∞“ì—ã –∫–∞—Ä—Ç–∞–ª–∞—Ä</h2>
  <div id="center-cards"></div>

  <h3 id="turnMsg"></h3>

  <div id="players"></div>
</div>

<div id="winner" style="display:none;">
  <h2 id="winnerMsg"></h2>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

// ---------- DOM Elements ----------
const playBtn = document.getElementById('playBtn');
const waitingMsg = document.getElementById('waitingMsg');
const roundDiv = document.getElementById('round');
const roundMsg = document.getElementById('roundMsg');
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const gameDiv = document.getElementById('game');
const cardsDiv = document.getElementById('cards');
const centerCardsDiv = document.getElementById('center-cards');
const turnMsg = document.getElementById('turnMsg');
const playersDiv = document.getElementById('players');
const winnerDiv = document.getElementById('winner');
const winnerMsg = document.getElementById('winnerMsg');

let myHand = [];
let myId = null;
let roomId = null;

// ---------- Play ----------
playBtn.onclick = () => {
  socket.emit('play');
  playBtn.disabled = true;
};

// ---------- Waiting ----------
socket.on('waiting', data => {
  waitingMsg.textContent = `–ö“Ø—Ç—ñ–ø —Ç“±—Ä–º—ã–∑: ${data.count}/3`;
});

// ---------- Room Joined ----------
socket.on('room_joined', data => {
  roomId = data.roomId;
  myId = socket.id;
  console.log('Room joined:', roomId, 'My ID:', myId);
});

// ---------- Round Question ----------
socket.on('ask_round', data => {
  roundDiv.style.display = 'block';
  roundMsg.textContent = data.message;
});

yesBtn.onclick = () => {
  socket.emit('round_answer', { roomId, answer: true });
  roundDiv.style.display = 'none';
};
noBtn.onclick = () => {
  socket.emit('round_answer', { roomId, answer: false });
  roundDiv.style.display = 'none';
};

// ---------- Round Started ----------
socket.on('round_started', () => {
  gameDiv.style.display = 'block';
  centerCardsDiv.innerHTML = '';
  cardsDiv.innerHTML = '';
  playersDiv.innerHTML = '';
  turnMsg.textContent = '';
});

// ---------- Receive Hand ----------
socket.on('your_cards', data => {
  myHand = data.hand;
  cardsDiv.innerHTML = '';
  myHand.forEach(card => {
    const c = document.createElement('div');
    c.className = 'card';
    c.textContent = card;
    c.onclick = () => {
      if (!c.classList.contains('disabled')) {
        socket.emit('play_card', { roomId, card });
      }
    };
    cardsDiv.appendChild(c);
  });
});

// ---------- Card Played ----------
socket.on('card_played', data => {
  const c = document.createElement('div');
  c.className = 'center-card';
  c.textContent = data.card;
  centerCardsDiv.appendChild(c);

  // –ï–≥–µ—Ä ”©–∑ –∫–∞—Ä—Ç–∞—Å—ã–Ω –∂“Ø—Ä—Å–µ, disable
  if (data.playerId === myId) {
    [...cardsDiv.children].forEach(ch => {
      if (ch.textContent === data.card) ch.classList.add('disabled');
    });
  }
});

// ---------- Your Turn ----------
socket.on('your_turn', data => {
  turnMsg.textContent = data.message;
});

// ---------- Trick Winner ----------
socket.on('trick_winner', data => {
  centerCardsDiv.innerHTML = '';
  turnMsg.textContent = `üèÜ ${data.winnerId} “±—Ç—Ç—ã`;
  // –û–π—ã–Ω—à—ã–ª–∞—Ä –º–µ–Ω “±—Ç“õ–∞–Ω –∂“Ø—Ä—ñ—Å —Å–∞–Ω—ã–Ω –∫”©—Ä—Å–µ—Ç—É
  playersDiv.innerHTML = '';
  for (const pid in data.tricksWon) {
    const div = document.createElement('div');
    div.className = 'player';
    div.textContent = `${pid}: ${data.tricksWon[pid]} –∂“Ø—Ä—ñ—Å`;
    playersDiv.appendChild(div);
  }
});

// ---------- Game Ended ----------
socket.on('game_ended', data => {
  gameDiv.style.display = 'none';
  winnerDiv.style.display = 'block';
  if(data.winnerId){
    winnerMsg.textContent = `–ñ–µ“£—ñ–º–ø–∞–∑: ${data.winnerId}`;
  } else {
    winnerMsg.textContent = data.message;
  }
});
</script>
</body>
</html>
