<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>3 ойыншы ставка ойыны</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; }
    #log { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; background: #fff; margin-bottom: 10px; }
    #players { margin-bottom: 10px; }
    #playerTurn { margin-top: 15px; }
    button { margin-left: 5px; }
  </style>
</head>
<body>

<h2>3 Ойыншы Ойыны</h2>

<div id="players">Ойыншылар:</div>
<div id="log"></div>

<!-- Бірінші ойыншы ставка енгізу -->
<div id="playerTurn" style="display:none;">
  <input type="number" id="chosenNumber" placeholder="50–150 аралығында сан">
  <button id="submitNumber">Жіберу</button>
</div>

<!-- Екінші ойыншы шешім қабылдау -->
<div id="playerDecision" style="display:none;">
  <span>Келесі ставкаға келісесіз бе?</span>
  <button id="agreeBtn">Келісемін</button>
  <button id="rejectBtn">Отбой</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  const playersDiv = document.getElementById("players");
  const logDiv = document.getElementById("log");
  const playerTurnDiv = document.getElementById("playerTurn");
  const chosenNumberInput = document.getElementById("chosenNumber");
  const submitNumberBtn = document.getElementById("submitNumber");
  const playerDecisionDiv = document.getElementById("playerDecision");
  const agreeBtn = document.getElementById("agreeBtn");
  const rejectBtn = document.getElementById("rejectBtn");

  const playerName = prompt("Атыңызды енгізіңіз:");
  socket.emit("join", playerName);

  function logMessage(msg) {
    const p = document.createElement("div");
    p.textContent = msg;
    logDiv.appendChild(p);
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  // Ойыншылардың жаңартылуы
  socket.on("room_update", (data) => {
    playersDiv.innerHTML = "Ойыншылар: ";
    data.players.forEach(p => {
      playersDiv.innerHTML += `${p.name} (Баланс: ${p.balance}) | `;
    });
  });

  // Логтар
  socket.on("log_update", (data) => {
    logMessage(data.msg);
  });

  // Бірінші немесе кезегі келген ойыншы
  socket.on("your_turn", (data) => {
    logMessage(data.message);

    if (data.previousNumber) {
      // 2-ші ойыншының шешімі
      playerDecisionDiv.style.display = "block";
    } else {
      // Бірінші ойыншының ставка енгізуі
      playerTurnDiv.style.display = "block";
    }
  });

  // Бірінші ойыншы ставка жіберу
  submitNumberBtn.addEventListener("click", () => {
    const number = parseInt(chosenNumberInput.value);
    if (isNaN(number) || number < 50 || number > 150) {
      return alert("50–150 аралығында сан енгізіңіз!");
    }
    socket.emit("player_choice", { number });
    playerTurnDiv.style.display = "none";
    chosenNumberInput.value = "";
  });

  // Екінші ойыншы шешім
  agreeBtn.addEventListener("click", () => {
    socket.emit("player_decision", { decision: "Келісемін" });
    playerDecisionDiv.style.display = "none";
  });

  rejectBtn.addEventListener("click", () => {
    socket.emit("player_decision", { decision: "Отбой" });
    playerDecisionDiv.style.display = "none";
  });

  // Ойын басталды
  socket.on("game_started", (data) => {
    logMessage("Ойын басталды! Ойыншылар: " + data.players.map(p => p.name).join(", "));
  });

  // Қате хабарлар
  socket.on("error_message", (data) => {
    alert(data.message);
  });
</script>

</body>
</html>
